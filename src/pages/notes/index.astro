---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const notes = await getCollection('notes');
const sortedNotes = notes.sort((a, b) =>
  a.data.title.localeCompare(b.data.title)
);
const notesByTopic = sortedNotes.reduce(
  (acc, note) => {
    const topic = note.data.topic || 'General';
    if (!acc[topic]) acc[topic] = [];
    acc[topic].push(note);
    return acc;
  },
  {} as Record<string, typeof sortedNotes>
);
---

<BaseLayout title="Notes" description="Technical notes and guides">
  <div class="min-h-screen bg-gray-100">
    <header class="bg-white border-b py-5">
      <div class="max-w-3xl mx-auto px-4">
        <a
          href="/"
          class="text-teal-600 hover:text-teal-700 focus:text-teal-700 focus:outline-none"
          >&larr; Home</a
        >
      </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold mb-8">Notes</h1>

      {
        notes.length === 0 ? (
          <p class="text-gray-600">No notes yet.</p>
        ) : (
          Object.entries(notesByTopic).map(([topic, topicNotes]) => (
            <section class="mb-8">
              <h2 class="text-lg font-semibold text-gray-700 mb-4">{topic}</h2>
              <ul class="space-y-3">
                {topicNotes.map((note) => (
                  <li>
                    <a
                      href={`/notes/${note.slug}/`}
                      class="block bg-white p-4 border hover:border-teal-500 focus:border-teal-500 transition-colors focus:outline-none"
                    >
                      <h3 class="font-semibold">{note.data.title}</h3>
                      <p class="text-sm text-gray-600">
                        {note.data.description}
                      </p>
                    </a>
                  </li>
                ))}
              </ul>
            </section>
          ))
        )
      }
    </main>
  </div>
</BaseLayout>
